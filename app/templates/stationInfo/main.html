{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지훈과 얼굴들</title>
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <script src="https://kit.fontawesome.com/addd9ad2f2.js" crossorigin="anonymous"></script>
    <script>
        function moveAndPinning(x, y) {
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                mapOption = {
                    center: new kakao.maps.LatLng(x + 0.0005, y - 0.003), // 지도의 중심좌표
                    level: 3 // 지도의 확대 레벨
                };

            var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

            // 마커가 표시될 위치입니다
            var markerPosition = new kakao.maps.LatLng(x, y);

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                position: markerPosition
            });

            // 마커가 지도 위에 표시되도록 설정합니다
            marker.setMap(map);


            const inputNode = document.getElementById("map");
            inputNode.style.removeProperty('position')
            inputNode.style.position = 'static'

            // 아래 코드는 지도 위의 마커를 제거하는 코드입니다
            // marker.setMap(null);
        };


        function updateStationID(stationID) {
            // 현재 URL 가져오기
            var currentUrl = window.location.href;

            // URL 파라미터 파싱하기
            var urlParams = new URLSearchParams(window.location.search);

            // stationID가 없으면 기본값으로 설정
            if (!stationID) {
                stationID = '1';
            }

            // 새로운 stationID 설정
            urlParams.set('stationID', stationID);

            // 새로운 URL 생성
            var newUrl = currentUrl.split('?')[0] + '?' + urlParams.toString();

            // 현재 URL이 바뀌었는지 확인 후 리다이렉트
            if (currentUrl !== newUrl) {
                window.location.href = newUrl;
            }
        }

        (function () {
            var w = window;
            if (w.ChannelIO) {
                return w.console.error("ChannelIO script included twice.");
            }
            var ch = function () {
                ch.c(arguments);
            };
            ch.q = [];
            ch.c = function (args) {
                ch.q.push(args);
            };
            w.ChannelIO = ch;

            function l() {
                if (w.ChannelIOInitialized) {
                    return;
                }
                w.ChannelIOInitialized = true;
                var s = document.createElement("script");
                s.type = "text/javascript";
                s.async = true;
                s.src = "https://cdn.channel.io/plugin/ch-plugin-web.js";
                var x = document.getElementsByTagName("script")[0];
                if (x.parentNode) {
                    x.parentNode.insertBefore(s, x);
                }
            }

            if (document.readyState === "complete") {
                l();
            } else {
                w.addEventListener("DOMContentLoaded", l);
                w.addEventListener("load", l);
            }
        })();

        ChannelIO('boot', {
            "pluginKey": "0924de9d-2a46-438a-b944-574439866f66"
        });
    </script>
</head>
<div>
    <div class="topbar">
        <div class="topbar-logo">
            <img src="{% static 'logo.png' %}">
            <h1>전기자동차 충전소 입지 분석도구</h1>
        </div>
        <div class="topbar-contents">
            <div class="topbar-group" style="margin: 0px 0px 0px 30px">
                <a href="#">입지 분석도구</a>
                <a href="/stationInfo">충전소 정보</a>
                <a href="#">충전기 관리</a>
                <a href="#">고객지원</a>
            </div>
            <div class="topbar-group" style="margin: 0px 20px 0px 0px">
                <a href="#">로그인</a>
                <a href="#">회원가입</a>
            </div>
        </div>
    </div>

    <div class="map-container" id="map">
        <div class="sidebar">
            <div class="sidebar-list">
                <div class="sidebar-card-top">
                    <div class="sidebar-card-top-title">
                        <a href="/stationInfo">충전소 정보</a>
                    </div>
                    <div class="pagination">
                        {% if data.value.result.has_previous %}
                            <a style="font-weight: 600" href="/stationInfo?page=1">&laquo;</a>
                            <a style="font-weight: 400"
                               href="/stationInfo?page={{ data.value.result.previous_page_number }}">이전</a>
                        {% else %}
                            <a style="font-weight: 600;color:#5d5d5d">&laquo;</a>
                            <a style="font-weight: 400;color:#5d5d5d">이전</a>
                        {% endif %}

                        <a>{{ data.value.result.number }} / {{ data.value.result.paginator.num_pages }}</a>

                        {% if data.value.result.has_next %}
                            <a href="/stationInfo?page={{ data.value.result.next_page_number }}">다음</a>
                            <a style="font-weight: 600"
                               href="/stationInfo?page={{ data.value.result.paginator.num_pages }}">&raquo;</a>
                        {% else %}
                            <a style="font-weight: 600;color:#5d5d5d">다음</a>
                            <a style="font-weight: 400;color:#5d5d5d">&raquo;</a>
                        {% endif %}
                    </div>
                </div>
                {% for station_info in data.value.result %}
                    <div onclick="updateStationID('{{ station_info.Station_ID }}');" class="card"
                         style="background:#6cd273;{% if '급속' in station_info and '완속' in station_info and station_info.Charging_Station_Name|length > 14 %}height: 165px;{% elif station_info.Charging_Station_Name|length > 14 %}height: 130px;{% endif %}">
                        <div class="card-title">
                            <a>{{ station_info.Charging_Station_Name }}</a>
                        </div>
                        {% if '급속' in station_info %}
                            <div class="card-contents">
                                <div style="background: #FFFFFF;border-radius: 20px;padding: 3px 12px">
                                    <i style="color: #FC4F5C" class="fa-solid fa-bolt"></i>
                                    <a style="font-weight: 600;color: #FC4F5C">급속</a>
                                </div>
                                <a style="margin: 0px 0px 0px 10px;padding: 3px 0px">{{ station_info.급속.count }}기</a>
                            </div>
                        {% endif %}
                        {% if '완속' in station_info %}
                            <div class="card-contents">
                                <div style="background: #FFFFFF;border-radius: 20px;padding: 3px 12px">
                                    <i style="color: #4294FB" class="fa-solid fa-bolt"></i>
                                    <a style="font-weight: 600;color: #4294FB">완속</a>
                                </div>
                                <a style="margin: 0px 0px 0px 10px;padding: 3px 0px">{{ station_info.완속.count }}기</a>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
                <div class="sidebar-card-top">
                    <div class="pagination">
                        {% if data.value.result.has_previous %}
                            <a style="font-weight: 600" href="/stationInfo?page=1">&laquo;</a>
                            <a style="font-weight: 400"
                               href="/stationInfo?page={{ data.value.result.previous_page_number }}">이전</a>
                        {% else %}
                            <a style="font-weight: 600;color:#5d5d5d">&laquo;</a>
                            <a style="font-weight: 400;color:#5d5d5d">이전</a>
                        {% endif %}

                        <a>{{ data.value.result.number }} / {{ data.value.result.paginator.num_pages }}</a>

                        {% if data.value.result.has_next %}
                            <a href="/stationInfo?page={{ data.value.result.next_page_number }}">다음</a>
                            <a style="font-weight: 600"
                               href="/stationInfo?page={{ data.value.result.paginator.num_pages }}">&raquo;</a>
                        {% else %}
                            <a style="font-weight: 600;color:#5d5d5d">다음</a>
                            <a style="font-weight: 400;color:#5d5d5d">&raquo;</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% if data.ui.isDetail == True %}
                <div class="sidebar-detail">
                    <div class="card-detail">
                        <div class="card-title-detail">
                            <a>{{ data.value.stationInfo.Charging_Station_Name }}</a>
                        </div>
                        <div class="card-contents-detail">
                            <a><i class="fa-solid fa-location-dot"></i>{{ data.value.stationInfo.Address }}</a>
                        </div>
                        <div class="card-title-detail">
                            <a>현재 충전기 상태</a>
                        </div>
                        <div>
                            {% if data.value.stationInfo.stationLiveInfo != None %}
                                {% for stationLiveInfo in data.value.stationInfo.stationLiveInfo.items.item %}
                                    <div class="card-subtitle">
                                        {% if stationLiveInfo.chgerType == "01" %}
                                            <a><img src="{% static 'ev-plug-chademo.svg' %}"/> DC차데모</a>
                                        {% elif stationLiveInfo.chgerType == "02" %}
                                            <a><img src="{% static 'ev-plug-type2.svg' %}"/> AC완속</a>
                                        {% elif stationLiveInfo.chgerType == "03" %}
                                            <a><img src="{% static 'ev-plug-chademo.svg' %}"/>
                                                <img src="{% static 'ev-plug-type2.svg' %}"/> DC차데모+AC3상</a>
                                        {% elif stationLiveInfo.chgerType == "04" %}
                                            <a><img src="{% static 'ev-plug-ccs1.svg' %}"/> DC콤보</a>
                                        {% elif stationLiveInfo.chgerType == "05" %}
                                            <a><img src="{% static 'ev-plug-chademo.svg' %}"/>
                                                <img src="{% static 'ev-plug-ccs1.svg' %}"/> DC차데모+DC콤보</a>
                                        {% elif stationLiveInfo.chgerType == "06" %}
                                            <a><img src="{% static 'ev-plug-chademo.svg' %}"/>
                                                <img src="{% static 'ev-plug-type2.svg' %}"/>
                                                <img src="{% static 'ev-plug-ccs1.svg' %}"/>
                                                DC차데모+AC3상+DC콤보</a>
                                        {% elif stationLiveInfo.chgerType == "07" %}
                                            <a><img src="{% static 'ev-plug-type2.svg' %}"/> AC3상</a>
                                        {% elif stationLiveInfo.chgerType == "08" %}
                                            <a><img src="{% static 'ev-plug-type2.svg' %}"/>
                                                <img src="{% static 'ev-plug-ccs1.svg' %}"/>
                                                DC콤보(완속)</a>
                                        {% elif stationLiveInfo.chgerType == "89" %}
                                            <a>H2 {{ stationLiveInfo.output }}kW</a>
                                        {% endif %}
                                    </div>
                                    <div class="card-contents-detail">
                                        <div class="card-icon" style="background: #468AF2">
                                            <a style="color: #FFFFFF">{{ stationLiveInfo.bnm }}</a>
                                        </div>
                                        <div class="card-icon" style="background: #468AF2">
                                            <a style="color: #FFFFFF">{{ stationLiveInfo.output }}kW</a>
                                        </div>
                                        <div class="card-icon" style="background: #468AF2">
                                            <a style="color: #FFFFFF">{{ stationLiveInfo.chgerId }}번</a>
                                        </div>
                                        {% if stationLiveInfo.stat == '1' %}
                                            <div class="card-icon" style="background-color: #E95C61">
                                                <a style="color: #FFFFFF">통신이상</a>
                                            </div>
                                        {% elif stationLiveInfo.stat == '2' %}
                                            <div class="card-icon" style="background-color: #86D07D">
                                                <a style="color: #FFFFFF">충전대기</a>
                                            </div>
                                        {% elif stationLiveInfo.stat == '3' %}
                                            <div class="card-icon" style="background-color: #1E1F22">
                                                <a style="color: #7c7c7c">충전중</a>
                                            </div>
                                        {% elif stationLiveInfo.stat == '4' %}
                                            <div class="card-icon" style="background-color: #E95C61">
                                                <a style="color: #FFFFFF">운영중지</a>
                                            </div>
                                        {% elif stationLiveInfo.stat == '5' %}
                                            <div class="card-icon" style="background-color: #E95C61">
                                                <a style="color: #FFFFFF">점검중</a>
                                            </div>
                                        {% elif stationLiveInfo.stat == '9' %}
                                            <div class="card-icon" style="background-color: #E95C61">
                                                <a style="color: #FFFFFF">상태미확인</a>
                                            </div>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            {% else %}
                        <div class="card-contents-detail">
                            <a><i class="fa-solid fa-warning"></i>이 충전소의 공공데이터를 불러올 수 없습니다.</a>
                        </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}

        </div>
    </div>


    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=fdcff0079fabbfce8f4e4c2b86c4d763"></script>

    <script>
        var container = document.getElementById('map');
        var options = {

            {% if data.ui.isDetail == True %}
                center: new kakao.maps.LatLng({{ data.value.stationInfo.Latitude }} + 0.0005, {{ data.value.stationInfo.Longitude }} - 0.003),
                level: 3
            {% else %}
                center: new kakao.maps.LatLng(35.01580038568427, 126.71084931904467),
                level: 5
            {% endif %}
        };

        var map = new kakao.maps.Map(container, options);

        {% if data.ui.isDetail == True %}

            // 마커가 표시될 위치입니다
            var markerPosition = new kakao.maps.LatLng({{ data.value.stationInfo.Latitude }}, {{ data.value.stationInfo.Longitude }});

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                position: markerPosition
            });

            // 마커가 지도 위에 표시되도록 설정합니다
            marker.setMap(map);
        {% endif %}


        const inputNode = document.getElementById("map");
        inputNode.style.removeProperty('position')
        inputNode.style.position = 'static'


    </script>

    </body>
</html>
