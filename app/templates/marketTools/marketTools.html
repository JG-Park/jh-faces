{% extends 'base.html' %}
{% load static %}

{% block head_script %}
{% endblock %}

{% block title %}ÏûÖÏßÄ Î∂ÑÏÑùÎèÑÍµ¨{% endblock %}
{% block content %}
    <div>
        <div class="map-container" id="map">
            <div class="sidebar" style="width:330px">
                <div class="sidebar-list">
                    <div style="display: flex;flex-direction: column;">
                        <div class="sidebar-card-top" style="height:auto">
                            <div class="sidebar-card-top-title">
                                <a style="cursor:pointer;" onclick="location.reload()">ÏûÖÏßÄ Î∂ÑÏÑùÎèÑÍµ¨</a>
                            </div>
                            <div class="sidebar-tools">
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>Í≤ÄÏÉâ</a>
                                        <div onclick="document.getElementById('gfid').value = '';"><i
                                                class="fa-solid fa-close"></i></div>
                                    </div>
                                    <form style="display: flex;justify-content: space-between;padding:0;" class="search"
                                          id="searchForm">
                                        <input style="width:185px;background-color: #FFFFFF" type="text" id="gfid"
                                               name="gfid" placeholder="üîç  Í≥†Ïú†ÏΩîÎìú">
                                        <label for="gfid" style="display: none">Í≤ÄÏÉâ</label>
                                        <button type="submit">Í≤ÄÏÉâ</button>
                                    </form>
                                </div>
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>Í≥µÏãúÏßÄÍ∞Ä</a>
                                        <div onclick="document.getElementById('minPrice').value = '';document.getElementById('maxPrice').value = '';">
                                            <i class="fa-solid fa-close"></i></div>
                                    </div>
                                    <form style="display: flex;justify-content: space-between;padding:0;" class="search"
                                          id="minmaxPriceForm">
                                        <input style="background-color: #FFFFFF" type="number" id="minPrice"
                                               name="minPrice" placeholder="ÏµúÏÜå">
                                        <label for="minPrice" style="display: none">ÏµúÏÜå</label>
                                        <a>-</a>
                                        <input style="background-color: #FFFFFF" type="number" id="maxPrice"
                                               name="maxPrice" placeholder="ÏµúÎåÄ">
                                        <label for="maxPrice" style="display: none">ÏµúÎåÄ</label>
                                        <button type="submit">ÏÑ§Ï†ï</button>
                                    </form>
                                </div>
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>Ïã†Í∑ú Ï∂îÏ≤ú ÏûÖÏßÄ(Í∑∏Î¶¨Îìú)</a>
                                    </div>
                                    <div class="menu-button-container">
                                        {% if request.GET.ResultGEO1 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('ResultGEO1', 'remove')">
                                                <a style="background-color: #F0766F;color:#FFFFFF">‚úî Í∏âÏÜç</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button" onclick="manipulateURLParam('ResultGEO1', 'true')">
                                                <a>‚ñ° Í∏âÏÜç</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.ResultGEO2 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('ResultGEO2', 'remove')">
                                                <a style="background-color: #4277F1;color:#FFFFFF">‚úî ÏôÑÏÜç</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button" onclick="manipulateURLParam('ResultGEO2', 'true')">
                                                <a>‚ñ° ÏôÑÏÜç</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.ResultGEO3 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('ResultGEO3', 'remove')">
                                                <a style="background-color: #BE83B9;color:#FFFFFF">‚úî Í∏â/ÏôÑÏÜç</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button" onclick="manipulateURLParam('ResultGEO3', 'true')">
                                                <a>‚ñ° Í∏â/ÏôÑÏÜç</a>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>Î≤†Ïä§Ìä∏ Ï∂îÏ≤ú ÏûÖÏßÄ</a>
                                        <div onclick="window.open('{{ data.value.downloadURL }}', '_blank');"><i class="fa-solid fa-cloud-download"></i></div>
                                    </div>
                                    <div class="menu-button-container">
                                        {% if request.GET.RecommandGEO1 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO1', 'remove')">
                                                <a style="background-color: #1D3557;color:white">‚úî Í∏âÏÜç</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO1', 'true')">
                                                <a>‚ñ° Í∏âÏÜç</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.RecommandGEO2 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO2', 'remove')">
                                                <a style="background-color: #457B9D;color:white">‚úî ÏôÑÏÜç</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO2', 'true')">
                                                <a>‚ñ° ÏôÑÏÜç</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.RecommandGEO3 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO3', 'remove')">
                                                <a style="background-color: #750D37;color:white">‚úî Í∏â/ÏôÑÏÜç</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO3', 'true')">
                                                <a>‚ñ° Í∏â/ÏôÑÏÜç</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.RecommandGSGEO %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGSGEO', 'remove')">
                                                <a style="background-color: #B87D4B;color:white">‚úî Ï£ºÏú†ÏÜå</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGSGEO', 'true')">
                                                <a>‚ñ° Ï£ºÏú†ÏÜå</a>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>Í∏∞Ï°¥ Ï∂©Ï†ÑÏÜå Ï∂îÍ∞Ä ÏÑ§Ïπò Ï∂îÏ≤ú</a>
                                    </div>
                                    <div class="menu-button-container">
                                        {% if request.GET.existInstalledGEO1 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGEO1', 'remove')">
                                                <a style="background-color: #85FF9E;color:#000000">‚úî Í∏âÏÜç</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGEO1', 'true')">
                                                <a>‚ñ° Í∏âÏÜç</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.existInstalledGEO2 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGEO2', 'remove')">
                                                <a style="background-color: #F29361;color:white">‚úî ÏôÑÏÜç</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGEO2', 'true')">
                                                <a>‚ñ° ÏôÑÏÜç</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.existInstalledGridGEO %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGridGEO', 'remove')">
                                                <a style="background-color: #EAC435;color:white">‚úî Í≤©Ïûê</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGridGEO', 'true')">
                                                <a>‚ñ° Í≤©Ïûê</a>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                        </div>
                        {% if data.ui.searchData == 'None' %}

                            <div class="card" id="card"
                                 style="background-color: #FFFFFF;margin: 10px 0 10px 20px;width:300px;">
                                <div class="card-title"
                                     style="display: flex;flex-direction: row;justify-content: space-between;padding-bottom: 10px">
                                    <a style="margin:0;color: #f5453d;">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</a>
                                    <div onclick="closeDetail();" style="width: 30px;height:30px;"><i
                                            style="color: #f5453d" class="fa-solid fa-close"></i></div>
                                </div>
                            </div>
                        {% else %}
                            <div class="card" id="card"
                                 style="display: none;background-color: #FFFFFF;margin: 10px 0 10px 20px;width:300px;">
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}s
{% block postScripts %}
    <script>
        function manipulateURLParam(param, action) {
            // ÌòÑÏû¨ URLÏùÑ Í∞ÄÏ†∏Ïò¥
            let currentURL = window.location.href;

            // URLÏóê Î¨ºÏùåÌëúÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
            let questionMarkIndex = currentURL.indexOf('?');
            let baseUrl = currentURL;
            let params = '';

            // URLÏóê Î¨ºÏùåÌëúÍ∞Ä ÏûàÎäî Í≤ΩÏö∞
            if (questionMarkIndex !== -1) {
                baseUrl = currentURL.substring(0, questionMarkIndex);
                params = currentURL.substring(questionMarkIndex + 1);
            }

            // URLÏóê ÌååÎùºÎØ∏ÌÑ∞Í∞Ä ÏûàÎäî Í≤ΩÏö∞
            if (params) {
                let queryParams = params.split('&');
                let paramExists = false;

                // ÌååÎùºÎØ∏ÌÑ∞Î•º ÌôïÏù∏ÌïòÏó¨ Ïù¥ÎØ∏ ÏûàÎäî Í≤ΩÏö∞ ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
                for (let i = 0; i < queryParams.length; i++) {
                    let pair = queryParams[i].split('=');
                    if (pair[0] === param) {
                        paramExists = true;
                        // Ï†úÍ±∞ ÎèôÏûëÏùº Í≤ΩÏö∞ Ìï¥Îãπ ÌååÎùºÎØ∏ÌÑ∞Î•º Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞
                        if (action === 'remove') {
                            queryParams.splice(i, 1);
                        }
                        break;
                    }
                }

                // ÌååÎùºÎØ∏ÌÑ∞ Ï∂îÍ∞Ä ÎèôÏûëÏùº Í≤ΩÏö∞
                if (action === 'true' && !paramExists) {
                    queryParams.push(param + '=true');
                }

                // Î≥ÄÍ≤ΩÎêú ÌååÎùºÎØ∏ÌÑ∞Î°ú URL Îã§Ïãú ÏÉùÏÑ±
                let newParams = queryParams.join('&');
                let newURL = baseUrl + '?' + newParams;
                window.history.replaceState({}, '', newURL);
            } else {
                // URLÏóê ÌååÎùºÎØ∏ÌÑ∞Í∞Ä ÏóÜÎäî Í≤ΩÏö∞
                if (action === 'true') {
                    window.history.replaceState({}, '', baseUrl + '?' + param + '=true');
                }
            }

            // ÌéòÏù¥ÏßÄ Îã§Ïãú Î°úÎìú
            location.reload();
        }

        function closeDetail() {
            let cardDiv = document.getElementById('card');
            if (cardDiv) {
                cardDiv.style.display = 'none';
            }
        }

        window.onload = function () {
            // Django Î∑∞ÏóêÏÑú Ï†ÑÎã¨Î∞õÏùÄ Í∞í ÌôïÏù∏
            var searchData = "{{ data.ui.searchData }}";

            // searchData Í∞íÏù¥ NoneÏù¥ ÏïÑÎãå Í≤ΩÏö∞
            if (searchData !== "None") {
                // ÌååÎùºÎØ∏ÌÑ∞Î™ÖÏúºÎ°ú ÌïòÎ©¥ÏÑú ÌååÎùºÎØ∏ÌÑ∞ Í∞íÏùÑ trueÎ°ú Ï∂îÍ∞Ä
                var urlParams = new URLSearchParams(window.location.search);
                urlParams.set(searchData, 'true');

                // URLÏùÑ ÏÉàÎ°úÏö¥ Ï£ºÏÜåÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
                window.history.replaceState({}, '', window.location.pathname + '?' + urlParams.toString());
            }
        };


        // URL ÌååÎùºÎØ∏ÌÑ∞Î•º Íµ¨Î¨∏ Î∂ÑÏÑùÌïòÎäî Ìï®Ïàò
        function getURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const params = Object.fromEntries(urlParams.entries());
            return params;
        }

        // URL ÌååÎùºÎØ∏ÌÑ∞Î•º ÏóÖÎç∞Ïù¥Ìä∏ÌïòÎäî Ìï®Ïàò
        function updateURLParams(params) {
            const searchParams = new URLSearchParams(params);
            const newURL = `${window.location.origin}${window.location.pathname}?${searchParams.toString()}`;
            window.history.replaceState({}, '', newURL);
            location.reload()
        }

        // Í≤ΩÍ≥†Ï∞ΩÏùÑ ÎùÑÏö∞Í≥† ÏÇ¨Ïö©ÏûêÍ∞Ä ÌôïÏù∏ÏùÑ ÎàÑÎ•º Í≤ΩÏö∞ÏóêÎßå trueÎ•º Î∞òÌôòÌïòÎäî Ìï®Ïàò
        function confirmAction(message) {
            return confirm(message);
        }

        // Ìèº Ï†úÏ∂úÏùÑ Ï≤òÎ¶¨ÌïòÎäî Ìï®Ïàò
        function handleFormSubmit(formId, paramKey) {
            document.getElementById(formId).addEventListener('submit', function (event) {
                event.preventDefault();
                const params = getURLParams();
                const input = document.getElementById(paramKey);

                if (formId === 'gfid') { // formIdÍ∞Ä 'gfid'Ïùº ÎïåÎßå Í≤ΩÍ≥† Î©îÏãúÏßÄ Ï∂úÎ†•
                    const confirmationMessage = "Í≤ÄÏÉâ Ïãú ÏÑ†ÌÉùÎêú Ìï≠Î™©Ïù¥ Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§. Í≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?";
                    if (confirmAction(confirmationMessage)) {
                        if (input.value.trim() !== '') {
                            params[paramKey] = input.value.trim();
                            deleteOtherParams(params, paramKey);
                            updateURLParams(params);
                            // Ï∂îÍ∞Ä ÏûëÏóÖÏùÑ ÏúÑÌïú ÏΩîÎìúÎ•º Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§. ÏòàÎ•º Îì§Ïñ¥, Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨ Îì±
                        } else {
                            delete params[paramKey];
                            updateURLParams(params);
                        }
                    }
                } else {
                    if (input.value.trim() !== '') {
                        params[paramKey] = input.value.trim();
                        deleteOtherParams(params, paramKey);
                        updateURLParams(params);
                        // Ï∂îÍ∞Ä ÏûëÏóÖÏùÑ ÏúÑÌïú ÏΩîÎìúÎ•º Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§. ÏòàÎ•º Îì§Ïñ¥, Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨ Îì±
                    } else {
                        delete params[paramKey];
                        updateURLParams(params);
                    }
                }
            });
        }

        // Îã§Î•∏ ÌååÎùºÎØ∏ÌÑ∞Î•º Î™®Îëê ÏÇ≠Ï†úÌïòÎäî Ìï®Ïàò
        function deleteOtherParams(params, paramKey) {
            for (const key in params) {
                if (key !== paramKey) {
                    delete params[key];
                }
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú ÏûÖÎ†•ÎûÄÏóê URL ÌååÎùºÎØ∏ÌÑ∞ Í∞íÏùÑ Ï±ÑÏö∞Îäî Ìï®Ïàò
        function populateInputWithParams(formId, paramKey) {
            const params = getURLParams();
            const input = document.getElementById(paramKey);

            if (params[paramKey]) {
                input.value = params[paramKey];
            }
        }

        // Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨
        handleFormSubmit('searchForm', 'gfid');
        populateInputWithParams('searchForm', 'gfid');

        handleFormSubmit('minmaxPriceForm', 'minPrice');
        handleFormSubmit('minmaxPriceForm', 'maxPrice');
        populateInputWithParams('minmaxPriceForm', 'minPrice');
        populateInputWithParams('minmaxPriceForm', 'maxPrice');

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú ÏûÖÎ†•ÎûÄÏóê URL ÌååÎùºÎØ∏ÌÑ∞ Í∞íÏùÑ Ï±ÑÏö∞Îäî Ìï®Ïàò
        window.addEventListener('load', function () {
            const params = getURLParams();
            const input = document.getElementById('gfid');

            if (params['gfid']) {
                input.value = params['gfid'];
            }
        });


        function transformCoord(coordinates, properties, type) {
            // MultiPolygon ÏßÄÏõêÏùÑ ÏúÑÌïú Î≥ÄÌôò Í≥ºÏ†ï
            let paths = [];

            if (type === 'polygon') {
                coordinates.forEach(polygon => {
                    let path = polygon.map(coord =>
                        new kakao.maps.LatLng(coord[1], coord[0]));
                    paths.push(path); // MultiPolygonÏùò Í≤ΩÏö∞ Ïó¨Îü¨ pathÎ•º Î∞∞Ïó¥Î°ú Í¥ÄÎ¶¨
                });
            } else if (type === 'circle') {
                coordinates.forEach(circle => {
                    paths.push(circle); // MultiPolygonÏùò Í≤ΩÏö∞ Ïó¨Îü¨ pathÎ•º Î∞∞Ïó¥Î°ú Í¥ÄÎ¶¨
                });

            }
            let result = {
                "name": properties.name,
                "gid": properties.gid,
                "fid": properties.fid,
                "y_pred_lgb": properties.y_pred_lgb,
                "color": properties.color,
                "public_price": properties.public_price,
                "population": properties.population,
                "altitude": properties.altitude,
                "emd_nm_k": properties.emd_nm_k,
                "path": paths
            };
            // ÎßåÏïΩ properties.addressÍ∞Ä Ï°¥Ïû¨ÌïúÎã§Î©¥
            if (properties.address) {
                result.address = properties.address; // address ÏÜçÏÑ±ÏùÑ Ï∂îÍ∞ÄÌï©ÎãàÎã§.
            }

            return result;
        }

        // ResultGEO Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
        const ResultGEO = {{ data.value.ResultGEO|safe }}

        let ResultGEO_AREA = [];
        // Ï¢åÌëú Ï∂îÏ∂ú Î∞è Í∏∞ÌÉÄ Ï†ïÎ≥¥ Î¶¨Ïä§Ìä∏Ìôî
        if (ResultGEO.features && ResultGEO.features.length > 0) {
            ResultGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryÏùò ÌÉÄÏûÖÏóê Îî∞Îùº Îã§Î£®Îäî Î∞©ÏãùÏù¥ Îã¨ÎùºÏßà Ïàò ÏûàÏäµÎãàÎã§.
                    const coordinates = feature.geometry.coordinates;
                    ResultGEO_AREA.push(transformCoord(coordinates, properties, 'polygon'));
                }
            });
        }


        // RecommandGEO Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
        const RecommandGEO = {{ data.value.RecommandGEO|safe }}

        let RecommandGEO_AREA = [];
        // Ï¢åÌëú Ï∂îÏ∂ú Î∞è Í∏∞ÌÉÄ Ï†ïÎ≥¥ Î¶¨Ïä§Ìä∏Ìôî
        if (RecommandGEO.features && RecommandGEO.features.length > 0) {
            RecommandGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryÏùò ÌÉÄÏûÖÏóê Îî∞Îùº Îã§Î£®Îäî Î∞©ÏãùÏù¥ Îã¨ÎùºÏßà Ïàò ÏûàÏäµÎãàÎã§.
                    const coordinates = feature.geometry.coordinates;
                    RecommandGEO_AREA.push(transformCoord(coordinates, properties, 'circle'));
                }
            });
        }


        // RecommandGSGEO Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
        const RecommandGSGEO = {{ data.value.RecommandGSGEO|safe }}

        let RecommandGSGEO_AREA = [];
        // Ï¢åÌëú Ï∂îÏ∂ú Î∞è Í∏∞ÌÉÄ Ï†ïÎ≥¥ Î¶¨Ïä§Ìä∏Ìôî
        if (RecommandGSGEO.features && RecommandGSGEO.features.length > 0) {
            RecommandGSGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryÏùò ÌÉÄÏûÖÏóê Îî∞Îùº Îã§Î£®Îäî Î∞©ÏãùÏù¥ Îã¨ÎùºÏßà Ïàò ÏûàÏäµÎãàÎã§.
                    const coordinates = feature.geometry.coordinates;
                    RecommandGSGEO_AREA.push(transformCoord(coordinates, properties, 'circle'));
                }
            });
        }

        // existInstalledGEO Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
        const existInstalledGEO = {{ data.value.existInstalledGEO|safe }}

        let existInstalledGEO_AREA = [];
        // Ï¢åÌëú Ï∂îÏ∂ú Î∞è Í∏∞ÌÉÄ Ï†ïÎ≥¥ Î¶¨Ïä§Ìä∏Ìôî
        if (existInstalledGEO.features && existInstalledGEO.features.length > 0) {
            existInstalledGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryÏùò ÌÉÄÏûÖÏóê Îî∞Îùº Îã§Î£®Îäî Î∞©ÏãùÏù¥ Îã¨ÎùºÏßà Ïàò ÏûàÏäµÎãàÎã§.
                    const coordinates = feature.geometry.coordinates;
                    existInstalledGEO_AREA.push(transformCoord(coordinates, properties, 'circle'));
                }
            });
        }

        // existInstalledGridGEO Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
        const existInstalledGridGEO = {{ data.value.existInstalledGridGEO|safe }}
        let existInstalledGridGEO_AREA = [];
        // Ï¢åÌëú Ï∂îÏ∂ú Î∞è Í∏∞ÌÉÄ Ï†ïÎ≥¥ Î¶¨Ïä§Ìä∏Ìôî
        if (existInstalledGridGEO.features && existInstalledGridGEO.features.length > 0) {
            existInstalledGridGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryÏùò ÌÉÄÏûÖÏóê Îî∞Îùº Îã§Î£®Îäî Î∞©ÏãùÏù¥ Îã¨ÎùºÏßà Ïàò ÏûàÏäµÎãàÎã§.
                    const coordinates = feature.geometry.coordinates;
                    existInstalledGridGEO_AREA.push(transformCoord(coordinates, properties, 'polygon'));
                }
            });
        }


        // ResultGEO: ÏòÅÏó≠Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
        for (let i = 0, len = ResultGEO_AREA.length; i < len; i++) {
            displayArea(ResultGEO_AREA[i], 'polygon');
        }


        // existInstalledGridGEO: ÏòÅÏó≠Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
        for (let i = 0, len = existInstalledGridGEO_AREA.length; i < len; i++) {
            displayArea(existInstalledGridGEO_AREA[i], 'polygon');
        }

        // RecommandGEO: ÏòÅÏó≠Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
        for (let i = 0, len = RecommandGEO_AREA.length; i < len; i++) {
            displayArea(RecommandGEO_AREA[i], 'circle');
        }

        // RecommandGSGEO: ÏòÅÏó≠Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
        for (let i = 0, len = RecommandGSGEO_AREA.length; i < len; i++) {
            displayArea(RecommandGSGEO_AREA[i], 'circle');
        }

        // existInstalledGEO: ÏòÅÏó≠Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
        for (let i = 0, len = existInstalledGEO_AREA.length; i < len; i++) {
            displayArea(existInstalledGEO_AREA[i], 'circle');
        }


        // Îã§Í∞ÅÌòïÏùÑ ÏÉùÏÑ±ÌïòÍ≥† Ïù¥Î≤§Ìä∏Î•º Îì±Î°ùÌïòÎäî Ìï®ÏàòÏûÖÎãàÎã§
        function displayArea(area, figureType) {
            // Ïõê ÏÉùÏÑ± ÏÉùÏÑ±Ìï©ÎãàÎã§
            if (figureType === 'circle') {
                let circle = new kakao.maps.Circle({
                        center: new kakao.maps.LatLng(area.path[0][1], area.path[0][0]),  // ÏõêÏùò Ï§ëÏã¨Ï¢åÌëú ÏûÖÎãàÎã§
                        radius: 100, // ÎØ∏ÌÑ∞ Îã®ÏúÑÏùò ÏõêÏùò Î∞òÏßÄÎ¶ÑÏûÖÎãàÎã§
                        strokeWeight: 3, // ÏÑ†Ïùò ÎëêÍªòÏûÖÎãàÎã§
                        strokeColor: area.color, // ÏÑ†Ïùò ÏÉâÍπîÏûÖÎãàÎã§
                        strokeOpacity: 1, // ÏÑ†Ïùò Î∂àÌà¨Î™ÖÎèÑ ÏûÖÎãàÎã§ 1ÏóêÏÑú 0 ÏÇ¨Ïù¥Ïùò Í∞íÏù¥Î©∞ 0Ïóê Í∞ÄÍπåÏö∏ÏàòÎ°ù Ìà¨Î™ÖÌï©ÎãàÎã§
                        strokeStyle: 'solid', // ÏÑ†Ïùò Ïä§ÌÉÄÏùº ÏûÖÎãàÎã§
                        fillColor: '#d3d3d3', // Ï±ÑÏö∞Í∏∞ ÏÉâÍπîÏûÖÎãàÎã§
                        fillOpacity: 0.7  // Ï±ÑÏö∞Í∏∞ Î∂àÌà¨Î™ÖÎèÑ ÏûÖÎãàÎã§
                    })
                ;

                circle.setMap(map);

                // Îã§Í∞ÅÌòïÏóê mouseover Ïù¥Î≤§Ìä∏Î•º Îì±Î°ùÌïòÍ≥† Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÎ©¥ Ìè¥Î¶¨Í≥§Ïùò Ï±ÑÏõÄÏÉâÏùÑ Î≥ÄÍ≤ΩÌï©ÎãàÎã§
                // ÏßÄÏó≠Î™ÖÏùÑ ÌëúÏãúÌïòÎäî Ïª§Ïä§ÌÖÄÏò§Î≤ÑÎ†àÏù¥Î•º ÏßÄÎèÑÏúÑÏóê ÌëúÏãúÌï©ÎãàÎã§
                kakao.maps.event.addListener(circle, 'mouseover', function (mouseEvent) {
                    circle.setOptions({fillColor: '#181818'});

                    customOverlay.setContent('<div class="area">' + area.name + '</div>');

                    customOverlay.setPosition(mouseEvent.latLng);
                    customOverlay.setMap(map);
                });

                // Îã§Í∞ÅÌòïÏóê mousemove Ïù¥Î≤§Ìä∏Î•º Îì±Î°ùÌïòÍ≥† Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÎ©¥ Ïª§Ïä§ÌÖÄ Ïò§Î≤ÑÎ†àÏù¥Ïùò ÏúÑÏπòÎ•º Î≥ÄÍ≤ΩÌï©ÎãàÎã§
                kakao.maps.event.addListener(circle, 'mousemove', function (mouseEvent) {
                    customOverlay.setPosition(mouseEvent.latLng);
                });

                // Îã§Í∞ÅÌòïÏóê mouseout Ïù¥Î≤§Ìä∏Î•º Îì±Î°ùÌïòÍ≥† Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÎ©¥ Ìè¥Î¶¨Í≥§Ïùò Ï±ÑÏõÄÏÉâÏùÑ ÏõêÎûòÏÉâÏúºÎ°ú Î≥ÄÍ≤ΩÌï©ÎãàÎã§
                // Ïª§Ïä§ÌÖÄ Ïò§Î≤ÑÎ†àÏù¥Î•º ÏßÄÎèÑÏóêÏÑú Ï†úÍ±∞Ìï©ÎãàÎã§
                kakao.maps.event.addListener(circle, 'mouseout', function () {
                    circle.setOptions({fillColor: '#d3d3d3'});
                    customOverlay.setMap(null);
                });

                // Îã§Í∞ÅÌòïÏóê click Ïù¥Î≤§Ìä∏Î•º Îì±Î°ùÌïòÍ≥† Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÎ©¥ Îã§Í∞ÅÌòïÏùò Ïù¥Î¶ÑÍ≥º Î©¥Ï†ÅÏùÑ Ïù∏Ìè¨ÏúàÎèÑÏö∞Ïóê ÌëúÏãúÌï©ÎãàÎã§
                kakao.maps.event.addListener(circle, 'click', function () {
                    let content =
                        '<div class="card-title" style="display: flex;flex-direction: row;justify-content: space-between">' +
                        '   <a style="margin:0;color: #181818;">' + area.name + '</a>' +
                        '   <div onclick="closeDetail();" style="width: 15px;height:15px;cursor:pointer;"><i class="fa-solid fa-close"></i></div>' +
                        '</div>' +

                        (area.address ?
                            '<div class="card-contents-detail" style="display: flex;flex-direction: column;padding: 0 0 20px 0">' +
                            '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-location-dot"></i>Ï£ºÏÜå</a><a style=padding-left:3px>' + area.address + '</a>' +
                            '</div>'
                            : '') +

                        (area.gid ?
                            '<div class="card-contents-detail">' +
                            '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-fingerprint"></i>Í≥†Ïú†ÏΩîÎìú:</a><a style=padding-left:3px>' + area.gid +
                            (area.fid ?
                                '(' + area.fid + ')'
                                : '') +

                            '</a>' +
                            '</div>'
                            : '') +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-location-dot"></i>Î≤ïÏ†ïÎèô:</a><a style=padding-left:3px>' + area.emd_nm_k + '</a>' +
                        '</div>' +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-sack-dollar"></i>Í≥µÏãúÏßÄÍ∞Ä:</a><a style=padding-left:3px>' + Math.floor(area.public_price).toLocaleString('ko-KR') + ' Ïõê/„é°</a>' +
                        '</div>' +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-people-roof"></i>Ïù∏Íµ¨:</a><a style=padding-left:3px>' + area.population + ' Î™Ö</a>' +
                        '</div>' +

                        '<div class="card-contents-detail" style="padding: 0 0 20px 0;">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-up-down"></i>Í≥†ÎèÑ:</a><a style=padding-left:3px>' + area.altitude + ' m</div>';
                    +
                        '</div>';
                    const element = document.getElementById('card');
                    element.style.display = 'block'
                    element.innerHTML = content
                })

            } else if (figureType === 'polygon') {
                let polygon = new kakao.maps.Polygon({
                    map: map,
                    path: area.path,
                    strokeWeight: 3,
                    strokeColor: area.color,
                    strokeOpacity: 1,
                    fillColor: '#FFFFFF',
                    fillOpacity: 0.5
                });

                // Îã§Í∞ÅÌòïÏóê mouseover Ïù¥Î≤§Ìä∏Î•º Îì±Î°ùÌïòÍ≥† Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÎ©¥ Ìè¥Î¶¨Í≥§Ïùò Ï±ÑÏõÄÏÉâÏùÑ Î≥ÄÍ≤ΩÌï©ÎãàÎã§
                // ÏßÄÏó≠Î™ÖÏùÑ ÌëúÏãúÌïòÎäî Ïª§Ïä§ÌÖÄÏò§Î≤ÑÎ†àÏù¥Î•º ÏßÄÎèÑÏúÑÏóê ÌëúÏãúÌï©ÎãàÎã§
                kakao.maps.event.addListener(polygon, 'mouseover', function (mouseEvent) {
                    polygon.setOptions({fillColor: '#181818'});

                    customOverlay.setContent('<div class="area">' + area.name + '</div>');

                    customOverlay.setPosition(mouseEvent.latLng);
                    customOverlay.setMap(map);
                });

                // Îã§Í∞ÅÌòïÏóê mousemove Ïù¥Î≤§Ìä∏Î•º Îì±Î°ùÌïòÍ≥† Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÎ©¥ Ïª§Ïä§ÌÖÄ Ïò§Î≤ÑÎ†àÏù¥Ïùò ÏúÑÏπòÎ•º Î≥ÄÍ≤ΩÌï©ÎãàÎã§
                kakao.maps.event.addListener(polygon, 'mousemove', function (mouseEvent) {

                    customOverlay.setPosition(mouseEvent.latLng);
                });

                // Îã§Í∞ÅÌòïÏóê mouseout Ïù¥Î≤§Ìä∏Î•º Îì±Î°ùÌïòÍ≥† Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÎ©¥ Ìè¥Î¶¨Í≥§Ïùò Ï±ÑÏõÄÏÉâÏùÑ ÏõêÎûòÏÉâÏúºÎ°ú Î≥ÄÍ≤ΩÌï©ÎãàÎã§
                // Ïª§Ïä§ÌÖÄ Ïò§Î≤ÑÎ†àÏù¥Î•º ÏßÄÎèÑÏóêÏÑú Ï†úÍ±∞Ìï©ÎãàÎã§
                kakao.maps.event.addListener(polygon, 'mouseout', function () {
                    polygon.setOptions({fillColor: '#FFFFFF'});
                    customOverlay.setMap(null);
                });

                // Îã§Í∞ÅÌòïÏóê click Ïù¥Î≤§Ìä∏Î•º Îì±Î°ùÌïòÍ≥† Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÎ©¥ Îã§Í∞ÅÌòïÏùò Ïù¥Î¶ÑÍ≥º Î©¥Ï†ÅÏùÑ Ïù∏Ìè¨ÏúàÎèÑÏö∞Ïóê ÌëúÏãúÌï©ÎãàÎã§
                kakao.maps.event.addListener(polygon, 'click', function () {
                    let predictionText = '';
                    if (area.y_pred_lgb === 1) {
                        predictionText = 'Í∏âÏÜç';
                        predictionColor = '#EC6060'
                    } else if (area.y_pred_lgb === 2) {
                        predictionText = 'ÏôÑÏÜç';
                        predictionColor = '#4277F1'
                    } else if (area.y_pred_lgb === 3) {
                        predictionText = 'Í∏â/ÏôÑÏÜç';
                        predictionColor = '#BE83B9'
                    }
                    let content =
                        '<div class="card-title" style="display: flex;flex-direction: row;justify-content: space-between">' +
                        '   <div style="display: flex"><a style="margin:0;color: #181818;">' + area.name + '</a>' +
                        '   <div style="margin: 0 0 0 10px;height:20px;background: ' + predictionColor + ';border-radius: 15px;padding: 2px 10px 2px 5px;color:#FFFFFF;"><i class="fa-solid fa-bolt"></i><a style="font-size:14px;">' + predictionText + '</a></div></div>' +
                        '   <div onclick="closeDetail();" style="width: 15px;height:15px;cursor:pointer;"><i class="fa-solid fa-close"></i></div>' +
                        '</div>' +
                        (area.gid ?
                            '<div class="card-contents-detail">' +
                            '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-fingerprint"></i>Í≥†Ïú†ÏΩîÎìú:</a><a style=padding-left:3px>' + area.gid +
                            (area.fid ?
                                '(' + area.fid + ')'
                                : '') +

                            '</a>' +
                            '</div>'
                            : '') +
                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-location-dot"></i>Î≤ïÏ†ïÎèô:</a><a style=padding-left:3px>' + area.emd_nm_k + '</a>' +
                        '</div>' +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-sack-dollar"></i>Í≥µÏãúÏßÄÍ∞Ä:</a><a style=padding-left:3px>' + Math.floor(area.public_price).toLocaleString('ko-KR') + ' Ïõê/„é°</a>' +
                        '</div>' +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-people-roof"></i>Ïù∏Íµ¨:</a><a style=padding-left:3px>' + area.population + ' Î™Ö</a>' +
                        '</div>' +

                        '<div class="card-contents-detail" style="padding: 0 0 20px 0;">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-up-down"></i>Í≥†ÎèÑ:</a><a style=padding-left:3px>' + area.altitude + ' m</div>';
                    '</div>';
                    const element = document.getElementById('card');
                    element.style.display = 'block'
                    element.innerHTML = content
                })
            }

        }

    </script>

{% endblock %}

